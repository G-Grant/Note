(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{363:function(s,a,e){s.exports=e.p+"assets/img/build-success.753ee4ba.png"},364:function(s,a,e){s.exports=e.p+"assets/img/process-1.dc33ff18.png"},365:function(s,a,e){s.exports=e.p+"assets/img/process-2.0aa76842.png"},366:function(s,a,e){s.exports=e.p+"assets/img/process-3.f7b6f176.png"},393:function(s,a,e){"use strict";e.r(a);var t=e(25),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"基于-gitlab-ci-搭建前端自动构建环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于-gitlab-ci-搭建前端自动构建环境","aria-hidden":"true"}},[s._v("#")]),s._v(" 基于 GitLab CI 搭建前端自动构建环境")]),s._v(" "),t("h2",{attrs:{id:"什么是持续集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是持续集成","aria-hidden":"true"}},[s._v("#")]),s._v(" 什么是持续集成 ?")]),s._v(" "),t("p",[s._v("持续集成（Continuous integration，简称CI）指的是，频繁地（一天多次）将代码集成到主干。")]),s._v(" "),t("h2",{attrs:{id:"gitlab-ci"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci","aria-hidden":"true"}},[s._v("#")]),s._v(" GitLab CI")]),s._v(" "),t("h3",{attrs:{id:"什么是-gitlab-ci"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-gitlab-ci","aria-hidden":"true"}},[s._v("#")]),s._v(" 什么是 GitLab CI ?")]),s._v(" "),t("p",[t("code",[s._v("GitLab CI")]),s._v(" 是 "),t("code",[s._v("GitLab Continuous Integration")]),s._v(" （Gitlab 持续集成）的简称。从 "),t("code",[s._v("GitLab")]),s._v(" 的 8.0 版本开始，"),t("code",[s._v("GitLab")]),s._v(" 就全面集成了 "),t("code",[s._v("Gitlab-CI")]),s._v(",并且对所有项目默认开启。只要在项目仓库的根目录添加 "),t("code",[s._v(".gitlab-ci.yml")]),s._v(" 文件，并且配置了 "),t("code",[s._v("Runner")]),s._v(" （运行器），那么每一次合并请求（MR）或者 "),t("code",[s._v("push")]),s._v(" 都会触发 "),t("code",[s._v("CI pipeline")]),s._v("。")]),s._v(" "),t("p",[s._v("如果一切运行正常，你将得到与 commit 关联的标记。如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:e(363),alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"什么是-pipeline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-pipeline","aria-hidden":"true"}},[s._v("#")]),s._v(" 什么是 Pipeline ?")]),s._v(" "),t("p",[s._v("一次 "),t("code",[s._v("Pipeline")]),s._v(" 其实相当于一次构建任务，里面可以包含多个流程，如安装依赖、运行测试、编译、部署测试服务器、部署生产服务器等流程。\n任何提交或者 Merge Request 的合并都可以触发 "),t("code",[s._v("Pipeline")]),s._v("，如下图所示：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n+------------------+           +----------------+\n|                  |  trigger  |                |\n|   Commit / MR    +----------\x3e+    Pipeline    |\n|                  |           |                |\n+------------------+           +----------------+\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"什么是-stages"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-stages","aria-hidden":"true"}},[s._v("#")]),s._v(" 什么是 Stages ?")]),s._v(" "),t("p",[t("code",[s._v("Stages")]),s._v(" 表示构建阶段，说白了就是上面提到的流程。\n我们可以在一次 "),t("code",[s._v("Pipeline")]),s._v(" 中定义多个 "),t("code",[s._v("Stages")]),s._v("，这些 "),t("code",[s._v("Stages")]),s._v(" 会有以下特点：")]),s._v(" "),t("ul",[t("li",[s._v("所有 "),t("code",[s._v("Stages")]),s._v(" 会按照顺序运行，即当一个 "),t("code",[s._v("Stage")]),s._v(" 完成后，下一个 "),t("code",[s._v("Stage")]),s._v(" 才会开始")]),s._v(" "),t("li",[s._v("只有当所有 "),t("code",[s._v("Stages")]),s._v(" 完成后，该构建任务 ("),t("code",[s._v("Pipeline")]),s._v(") 才会成功")]),s._v(" "),t("li",[s._v("如果任何一个 "),t("code",[s._v("Stage")]),s._v(" 失败，那么后面的 "),t("code",[s._v("Stages")]),s._v(" 不会执行，该构建任务 ("),t("code",[s._v("Pipeline")]),s._v(") 失败")])]),s._v(" "),t("p",[s._v("因此，"),t("code",[s._v("Stages")]),s._v(" 和 "),t("code",[s._v("Pipeline")]),s._v(" 的关系就是：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("+--------------------------------------------------------+\n|                                                        |\n|  Pipeline                                              |\n|                                                        |\n|  +-----------+     +------------+      +------------+  |\n|  |  Stage 1  |----\x3e|   Stage 2  |-----\x3e|   Stage 3  |  |\n|  +-----------+     +------------+      +------------+  |\n|                                                        |\n+--------------------------------------------------------+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"什么是-jobs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-jobs","aria-hidden":"true"}},[s._v("#")]),s._v(" 什么是 Jobs ?")]),s._v(" "),t("p",[t("code",[s._v("Jobs")]),s._v(" 表示构建工作，表示某个 Stage 里面执行的工作。\n我们可以在 "),t("code",[s._v("Stages")]),s._v(" 里面定义多个 "),t("code",[s._v("Jobs")]),s._v("，这些 "),t("code",[s._v("Jobs")]),s._v(" 会有以下特点：")]),s._v(" "),t("ul",[t("li",[s._v("相同 "),t("code",[s._v("Stage")]),s._v(" 中的 "),t("code",[s._v("Jobs")]),s._v(" 会并行执行")]),s._v(" "),t("li",[s._v("相同 "),t("code",[s._v("Stage")]),s._v(" 中的 "),t("code",[s._v("Jobs")]),s._v(" 都执行成功时，该 Stage 才会成功")]),s._v(" "),t("li",[s._v("如果任何一个 "),t("code",[s._v("Job")]),s._v(" 失败，那么该 "),t("code",[s._v("Stage")]),s._v(" 失败，即该构建任务 ("),t("code",[s._v("Pipeline")]),s._v(") 失败")])]),s._v(" "),t("p",[s._v("所以，"),t("code",[s._v("Jobs")]),s._v(" 和 "),t("code",[s._v("Stage")]),s._v(" 的关系图就是：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n+------------------------------------------+\n|                                          |\n|  Stage 1                                 |\n|                                          |\n|  +---------+  +---------+  +---------+   |\n|  |  Job 1  |  |  Job 2  |  |  Job 3  |   |\n|  +---------+  +---------+  +---------+   |\n|                                          |\n+------------------------------------------+\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装配置")]),s._v(" "),t("blockquote",[t("p",[s._v("安装环境为 "),t("code",[s._v("Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-105-generic x86_64)")]),s._v(" ，"),t("code",[s._v("docker")]),s._v(" 版本为 "),t("code",[s._v("Docker version 18.03.1-ce, build 9ee9f40")])])]),s._v(" "),t("ul",[t("li",[s._v("安装 "),t("code",[s._v("gitlab-ci-multi-runner")])])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For Debian/Ubuntu")]),s._v("\ncurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("L https:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("packages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gitlab"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repositories"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("runner"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("multi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" sudo bash\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For RHEL/CentOS")]),s._v("\ncurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("L https:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("packages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gitlab"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repositories"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("runner"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("multi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rpm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" sudo bash\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("查看 "),t("code",[s._v("docker images")])])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nsudo docker images\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"如何使用-gitlab-ci"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何使用-gitlab-ci","aria-hidden":"true"}},[s._v("#")]),s._v(" 如何使用 GitLab CI ?")]),s._v(" "),t("ul",[t("li",[s._v("在项目根目录创建 "),t("code",[s._v(".gitlab-ci.yml")]),s._v(" 文件，文件代码如下：")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("stages")]),s._v(" 定义 "),t("code",[s._v("Stages")]),s._v("，默认有三个 "),t("code",[s._v("Stages")]),s._v("，分别是 "),t("code",[s._v("build")]),s._v("，"),t("code",[s._v("test")]),s._v("，"),t("code",[s._v("deploy")]),s._v("。"),t("code",[s._v("Job.only")]),s._v(" 定义只有 "),t("code",[s._v("develop")]),s._v(" 分支会触发相关的 "),t("code",[s._v("Jobs")]),s._v("。")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nstages:\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" build\njob1:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启 debug 模式")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# variables:")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     CI_DEBUG_TRACE: "true"')]),s._v("\n    stage: build\n    tags:\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 新建 runner 的标签\n    only:\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" develop\n    script:\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cd public\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" npm i\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" npm run build\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ul",[t("li",[s._v("进入 "),t("code",[s._v("pipeline")]),s._v(" 配置页面")])]),s._v(" "),t("p",[t("img",{attrs:{src:e(364),alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("记下 "),t("code",[s._v("URL")]),s._v(" 和 "),t("code",[s._v("Token")]),s._v("，留以注册 "),t("code",[s._v("runner")]),s._v(" 使用")])]),s._v(" "),t("h3",{attrs:{id:"注册-runner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册-runner","aria-hidden":"true"}},[s._v("#")]),s._v(" 注册 runner")]),s._v(" "),t("ul",[t("li",[s._v("注册 "),t("code",[s._v("runner")]),s._v(","),t("code",[s._v("runner")]),s._v(" 注册成功之后，你会在 "),t("code",[s._v("pipeline")]),s._v(" 配置页面看见 "),t("code",[s._v("specific runners")]),s._v(" 下多出了你刚新增的 "),t("code",[s._v("runner")]),s._v("。")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nsudo gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("multi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner register\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )")]),s._v("\n\n你的 URL\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please enter the gitlab-ci token for this runner")]),s._v("\n\n你的 Token\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please enter the gitlab-ci description for this runner")]),s._v("\n\nmy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please enter the gitlab-ci tags for this runner (comma separated)")]),s._v("\n\nmy"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner\n\nWhether to run untagged builds "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[true/false]")]),s._v(":\n\nfalse\n\nWhether to lock Runner to current project "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[true/false]")]),s._v(":\n\nfalse\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please enter the executor: shell, docker, docker-ssh, ssh?")]),s._v("\n\ndocker\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please enter the Docker image (eg. ruby:2.1):")]),s._v("\n\nnode:9"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("ul",[t("li",[s._v("卸载  "),t("code",[s._v("runner")])])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nsudo gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("multi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner unregister "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("url url地址 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token tocken值\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("查看 "),t("code",[s._v("runner")]),s._v(" 状态")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nsudo gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("multi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner status\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("查看 "),t("code",[s._v("runner")]),s._v(" 列表")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nsudo gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("multi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner list\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("查看 "),t("code",[s._v("runner")]),s._v(" 配置文件")])]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nsudo vim "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gitlab"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("runner"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("toml\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"大功告成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#大功告成","aria-hidden":"true"}},[s._v("#")]),s._v(" 大功告成")]),s._v(" "),t("p",[s._v("切换到项目 "),t("code",[s._v("Pipelines")]),s._v(" 页面，发现出现以下情况，则代表你的 "),t("code",[s._v("runner")]),s._v(" 已经配置完成，你的每一次提交都会触发 "),t("code",[s._v("runner")]),s._v("。")]),s._v(" "),t("p",[t("img",{attrs:{src:e(365),alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"备注"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备注","aria-hidden":"true"}},[s._v("#")]),s._v(" 备注")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用 GitLab CI 克隆私有仓库时候，会提示 "),t("code",[s._v("Host key verification failed")]),s._v("。")]),s._v(" "),t("p",[s._v("需要做如下配置，"),t("code",[s._v("Key")]),s._v(" 写入 "),t("code",[s._v("SSH_PRIVATE_KEY")]),s._v("，"),t("code",[s._v("Value")]),s._v(" 写入 服务器 "),t("code",[s._v("private SSH key")]),s._v("。然后在 "),t("code",[s._v(".gitlab-ci.yml")]),s._v(" 文件前面写入如下代码，并保存。")]),s._v(" "),t("p",[t("img",{attrs:{src:e(366),alt:"img"}})]),s._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("\nbefore_script:\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Run ssh-agent (inside the build environment)")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" eval $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ssh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("agent "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add the SSH key stored in SSH_PRIVATE_KEY variable to the agent store")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ssh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("add <"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SSH_PRIVATE_KEY")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" mkdir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p ~"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssh\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[[ -f /.dockerenv ]] && echo -e \"Host *\\n\\tStrictHostKeyChecking no\\n\\n\" > ~/.ssh/config'")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接","aria-hidden":"true"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://stackoverflow.com/questions/25689231/getting-gitlab-ci-to-clone-private-repositories/44577067",target:"_blank",rel:"noopener noreferrer"}},[s._v("Getting GitLab CI to clone private repositories"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://scarletsky.github.io/2016/07/29/use-gitlab-ci-for-continuous-integration/",target:"_blank",rel:"noopener noreferrer"}},[s._v("用 GitLab CI 进行持续集成"),t("OutboundLink")],1)]),s._v(" "),t("comment-comment")],1)}),[],!1,null,null,null);a.default=n.exports}}]);