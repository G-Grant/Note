<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一起来学习如何用 Node 来制作 CLI | 博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" href="/Note/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Note/favicon.ico" type="image/x-icon">
    <meta name="description" content="不积跬步，无以至千里；不积小流，无以成江海。">
    <link rel="preload" href="/Note/assets/css/0.styles.912d5f67.css" as="style"><link rel="preload" href="/Note/assets/js/app.d8addd1b.js" as="script"><link rel="preload" href="/Note/assets/js/2.ea6ca259.js" as="script"><link rel="preload" href="/Note/assets/js/11.b070fa8b.js" as="script"><link rel="preload" href="/Note/assets/js/15.d0f1fe9f.js" as="script"><link rel="prefetch" href="/Note/assets/js/10.364bfac9.js"><link rel="prefetch" href="/Note/assets/js/12.87e564c0.js"><link rel="prefetch" href="/Note/assets/js/13.93618547.js"><link rel="prefetch" href="/Note/assets/js/14.f132774e.js"><link rel="prefetch" href="/Note/assets/js/16.eb2ef4ca.js"><link rel="prefetch" href="/Note/assets/js/17.59033c4d.js"><link rel="prefetch" href="/Note/assets/js/18.39a25dcb.js"><link rel="prefetch" href="/Note/assets/js/19.0a20a7e3.js"><link rel="prefetch" href="/Note/assets/js/20.c0d02306.js"><link rel="prefetch" href="/Note/assets/js/21.e81858cf.js"><link rel="prefetch" href="/Note/assets/js/22.4959798d.js"><link rel="prefetch" href="/Note/assets/js/23.f85a7dfb.js"><link rel="prefetch" href="/Note/assets/js/24.d1277292.js"><link rel="prefetch" href="/Note/assets/js/25.50ee3d85.js"><link rel="prefetch" href="/Note/assets/js/26.2b1f31c1.js"><link rel="prefetch" href="/Note/assets/js/27.8fdc9a75.js"><link rel="prefetch" href="/Note/assets/js/28.0e2381a5.js"><link rel="prefetch" href="/Note/assets/js/29.77e93840.js"><link rel="prefetch" href="/Note/assets/js/3.275498d0.js"><link rel="prefetch" href="/Note/assets/js/30.b7483e03.js"><link rel="prefetch" href="/Note/assets/js/31.59e53743.js"><link rel="prefetch" href="/Note/assets/js/32.00e52397.js"><link rel="prefetch" href="/Note/assets/js/33.0acef753.js"><link rel="prefetch" href="/Note/assets/js/34.4e58ba6f.js"><link rel="prefetch" href="/Note/assets/js/35.87dda1b4.js"><link rel="prefetch" href="/Note/assets/js/36.a5069380.js"><link rel="prefetch" href="/Note/assets/js/37.dda07340.js"><link rel="prefetch" href="/Note/assets/js/4.af59e2a3.js"><link rel="prefetch" href="/Note/assets/js/5.6cbca780.js"><link rel="prefetch" href="/Note/assets/js/6.92174d3c.js"><link rel="prefetch" href="/Note/assets/js/7.6a3045d5.js"><link rel="prefetch" href="/Note/assets/js/8.525bfe4b.js"><link rel="prefetch" href="/Note/assets/js/9.00848bb5.js">
    <link rel="stylesheet" href="/Note/assets/css/0.styles.912d5f67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Note/" class="home-link router-link-active"><!----> <span class="site-name">博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Note/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/G-Grant" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Note/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/G-Grant" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>一起来学习如何用 Node 来制作 CLI</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Note/20180725.html#cli-是什么" class="sidebar-link">CLI 是什么</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Note/20180725.html#为什么要开发一个-cli" class="sidebar-link">为什么要开发一个 CLI</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Note/20180725.html#怎么开发一个-cli" class="sidebar-link">怎么开发一个 CLI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/20180725.html#准备" class="sidebar-link">准备</a></li><li class="sidebar-sub-header"><a href="/Note/20180725.html#开始" class="sidebar-link">开始</a></li><li class="sidebar-sub-header"><a href="/Note/20180725.html#逐步深入" class="sidebar-link">逐步深入</a></li></ul></li><li><a href="/Note/20180725.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一起来学习如何用-node-来制作-cli"><a href="#一起来学习如何用-node-来制作-cli" aria-hidden="true" class="header-anchor">#</a> 一起来学习如何用 Node 来制作 CLI</h1> <h2 id="cli-是什么"><a href="#cli-是什么" aria-hidden="true" class="header-anchor">#</a> CLI 是什么</h2> <p>提起 <code>CLI</code>，不由得会想起 <code>vue-cli</code> 和 <code>angular-cli</code>，它们都是基于 <code>Node</code> 的命令行工具。</p> <h2 id="为什么要开发一个-cli"><a href="#为什么要开发一个-cli" aria-hidden="true" class="header-anchor">#</a> 为什么要开发一个 <code>CLI</code></h2> <p>假设你现在要建立一个新项目 ，这个项目配置和之前的项目配置是一样的。在你没有 <code>CLI</code> 的时候，你只能通过复制、粘贴来进行。然而，当你有了 <code>CLI</code>，你就可以通过命令来完成这些步骤。当然，你可以说就新建一个项目，完全没必要再开发一个 <code>CLI</code> 工具。那如果你要新建 n 个项目呢？这个时候，有 <code>CLI</code> 和没有 <code>CLI</code> 的区别就体现出来了。</p> <h2 id="怎么开发一个-cli"><a href="#怎么开发一个-cli" aria-hidden="true" class="header-anchor">#</a> 怎么开发一个 <code>CLI</code></h2> <h3 id="准备"><a href="#准备" aria-hidden="true" class="header-anchor">#</a> 准备</h3> <p>开发一个 <code>CLI</code>，需要用到以下工具：</p> <ul><li><a href="https://github.com/tj/commander.js/" target="_blank" rel="noopener noreferrer">commander.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/shelljs/shelljs" target="_blank" rel="noopener noreferrer">ShellJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/flipxfx/download-git-repo" target="_blank" rel="noopener noreferrer">download-git-repo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener noreferrer">chalk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/SBoudrias/Inquirer.js/" target="_blank" rel="noopener noreferrer">inquirer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/sindresorhus/ora" target="_blank" rel="noopener noreferrer">ora<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="开始"><a href="#开始" aria-hidden="true" class="header-anchor">#</a> 开始</h3> <p>新建一个文件夹，名称起做 <code>demo-cli</code>，并在文件夹内 <code>npm init</code>。在 <code>demo-cli</code> 文件夹内，新建 <code>bin</code> 文件夹，并在该文件夹内新建 <code>index.js</code> 文件。紧接着，打开 <code>demo-cli</code> 文件夹内的 <code>package.json</code> 文件，在里面新增如下命令。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;demo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/index.js&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这句代码的意思是指，在你使用 <code>demo</code> 命令的时候，会去执行 <code>bin</code> 文件夹下的 <code>index.js</code> 文件。</p> <p>这时候，我们在 <code>index.js</code> 文件，写入以下代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello CLI'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在 <code>demo-cli</code> 目录下依次运行 <code>npm link</code>、<code>demo</code>，这个时候，你会发现控制台输出了 <code>hello CLI</code>。</p> <p><img src="/Note/assets/img/hello-CLI.e00cc00f.png" alt="img"></p> <blockquote><p>备注：</p> <ul><li><code>#!/usr/bin/env node</code> 告诉操作系统用 <code>Node</code> 来运行此文件</li> <li><code>npm link</code> 作用主要是，在开发 <code>npm</code> 模块的时候，我们会希望边开发边调试。这个时候，<code>npm link</code> 就派上用场了。</li></ul></blockquote> <h3 id="逐步深入"><a href="#逐步深入" aria-hidden="true" class="header-anchor">#</a> 逐步深入</h3> <ol><li>在 <code>index.js</code> 文件内，写入以下代码。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">'1.0.0'</span><span class="token punctuation">,</span> <span class="token string">'-v, --version'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init &lt;dir&gt;'</span><span class="token punctuation">,</span> <span class="token string">'generate a new project'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>commander</code> 提供了一种使用 <code>node.js</code> 来开发命令行的可能性。我们可以通过 <code>commander</code> 的 <code>option</code> 方法，来定义 <code>commander</code> 的选项，当然，这些定义的选项也会被作为该命令的帮助文档。</p> <ul><li><p><code>version</code>：用来定义版本号。<code>commander</code> 默认帮我们添加 <code>-V, --version</code> 选项。当然，我们也可以重设它。</p></li> <li><p><code>command</code>：<code>&lt;&gt;</code> 代表必填，<code>[]</code> 代表选填。当 <code>.command()</code> 带有描述参数时，不能采用 <code>.action(callback)</code> 来处理子命令，否则会出错。这告诉 <code>commander</code>，你将采用单独的可执行文件作为子命令。</p></li> <li><p><code>parse</code>：解析 <code>process.argv</code>，解析完成后的数据会存放到 <code>new Command().args</code> 数组中。<code>process.argv</code> 里面存储内容如下：</p> <p><img src="/Note/assets/img/process.argv.e46ebd19.png" alt="img"></p></li></ul> <p>所以，我们可以通过 <code>program.args[0]</code> 来取出 <code>dir</code> 的值。</p> <blockquote><p>问题：为什么当 <code>command</code> 没有描述参数，且 <code>parse</code> 方法使用链式调用会报错？（<em>猜想：<code>command</code> 有 <code>desc</code> 参数时，返回的是 <code>this</code>，当没有 <code>desc</code> 参数时，返回的是新对象</em>，根据 <code>API Document</code> 得出）</p></blockquote> <div class="language- extra-class"><pre><code>```js
// 正确
program
    .version('1.0.0', '-v, --version')
    .command('init &lt;dir&gt;', 'generate a new project')
    .action(function(dir, cmd){
        console.log(dir, cmd)
    })
    .parse(process.argv);

// 正确
program
    .version('1.0.0', '-v, --version')
    .command('init &lt;dir&gt;', 'generate a new project')
    .action(function(dir, cmd){
        console.log(dir, cmd)
    })
program.parse(process.argv);

// 正确
program
    .version('1.0.0', '-v, --version')
    .command('init &lt;dir&gt;')
    .action(function(dir, cmd){
        console.log(dir, cmd)
    })
program.parse(process.argv);

// 错误
program
    .version('1.0.0', '-v, --version')
    .command('init &lt;dir&gt;')
    .action(function(dir, cmd){
        console.log(dir, cmd)
    })
    .parse(process.argv);
```
</code></pre></div><ol><li>在 <code>bin</code> 文件下创建 <code>demo-init.js</code> 文件，部分代码如下：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'shelljs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'download-git-repo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> dir <span class="token operator">=</span> program<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> questions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'请输入项目名称'</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'demo-static'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/^[a-z]+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">'项目名称必须以小写字母开头'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span>questions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 初始化模板文件</span>
    <span class="token function">downloadTemplate</span><span class="token punctuation">(</span>answers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">downloadTemplate</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> isHasDir <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isHasDir<span class="token punctuation">)</span><span class="token punctuation">{</span>
        spinner<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'当前目录已存在!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 开始下载模板文件</span>
    <span class="token function">download</span><span class="token punctuation">(</span><span class="token string">'gitlab:git.gitlab.com/demo-static'</span><span class="token punctuation">,</span> dir<span class="token punctuation">,</span> <span class="token punctuation">{</span>clone<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            spinner<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">updateTemplateFile</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateTemplateFile</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> description <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/public/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> buffer</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        shell<span class="token punctuation">.</span><span class="token function">rm</span><span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/.git</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shell<span class="token punctuation">.</span><span class="token function">rm</span><span class="token punctuation">(</span><span class="token string">'-f'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/public/CHANGELOG.md</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> packageJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/public/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/README.md</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"># </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        spinner<span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token string">'创建完毕'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><ul><li><code>inquirer</code> 主要提供交互式命令的功能。<code>validate</code> 返回 <code>true</code> 代表输入值验证合法，如果返回任意字符串，则会替代默认的错误消息返回。</li> <li>通过 <code>Node</code> 中 <code>fs</code> 模块来判断文件夹是否已存在。
<blockquote><p><code>path.resolve</code> 方法用于将相对路径转为绝对路径。它可以接受多个参数，依次表示所要进入的路径，直到将最后一个参数转为绝对路径。如果根据参数无法得到绝对路径，就以当前所在路径作为基准。除了根目录，该方法的返回值都不带尾部的斜杠。</p></blockquote></li></ul> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md" target="_blank" rel="noopener noreferrer">Commander.js 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://javascript.ruanyifeng.com/nodejs/path.html#toc1" target="_blank" rel="noopener noreferrer">JavaScript 标准参考教程（alpha）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">8/10/2019, 7:38:12 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/Note/assets/js/app.d8addd1b.js" defer></script><script src="/Note/assets/js/2.ea6ca259.js" defer></script><script src="/Note/assets/js/11.b070fa8b.js" defer></script><script src="/Note/assets/js/15.d0f1fe9f.js" defer></script>
  </body>
</html>
