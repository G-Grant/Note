<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《高性能JavaScript》读书笔记 | 博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" href="/Note/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/Note/favicon.ico" type="image/x-icon">
    <meta name="description" content="不积跬步，无以至千里；不积小流，无以成江海。">
    <link rel="preload" href="/Note/assets/css/0.styles.912d5f67.css" as="style"><link rel="preload" href="/Note/assets/js/app.d8addd1b.js" as="script"><link rel="preload" href="/Note/assets/js/2.ea6ca259.js" as="script"><link rel="preload" href="/Note/assets/js/9.00848bb5.js" as="script"><link rel="preload" href="/Note/assets/js/15.d0f1fe9f.js" as="script"><link rel="prefetch" href="/Note/assets/js/10.364bfac9.js"><link rel="prefetch" href="/Note/assets/js/11.b070fa8b.js"><link rel="prefetch" href="/Note/assets/js/12.87e564c0.js"><link rel="prefetch" href="/Note/assets/js/13.93618547.js"><link rel="prefetch" href="/Note/assets/js/14.f132774e.js"><link rel="prefetch" href="/Note/assets/js/16.eb2ef4ca.js"><link rel="prefetch" href="/Note/assets/js/17.59033c4d.js"><link rel="prefetch" href="/Note/assets/js/18.39a25dcb.js"><link rel="prefetch" href="/Note/assets/js/19.0a20a7e3.js"><link rel="prefetch" href="/Note/assets/js/20.c0d02306.js"><link rel="prefetch" href="/Note/assets/js/21.e81858cf.js"><link rel="prefetch" href="/Note/assets/js/22.4959798d.js"><link rel="prefetch" href="/Note/assets/js/23.f85a7dfb.js"><link rel="prefetch" href="/Note/assets/js/24.d1277292.js"><link rel="prefetch" href="/Note/assets/js/25.50ee3d85.js"><link rel="prefetch" href="/Note/assets/js/26.2b1f31c1.js"><link rel="prefetch" href="/Note/assets/js/27.8fdc9a75.js"><link rel="prefetch" href="/Note/assets/js/28.0e2381a5.js"><link rel="prefetch" href="/Note/assets/js/29.77e93840.js"><link rel="prefetch" href="/Note/assets/js/3.275498d0.js"><link rel="prefetch" href="/Note/assets/js/30.b7483e03.js"><link rel="prefetch" href="/Note/assets/js/31.59e53743.js"><link rel="prefetch" href="/Note/assets/js/32.00e52397.js"><link rel="prefetch" href="/Note/assets/js/33.0acef753.js"><link rel="prefetch" href="/Note/assets/js/34.4e58ba6f.js"><link rel="prefetch" href="/Note/assets/js/35.87dda1b4.js"><link rel="prefetch" href="/Note/assets/js/36.a5069380.js"><link rel="prefetch" href="/Note/assets/js/37.dda07340.js"><link rel="prefetch" href="/Note/assets/js/4.af59e2a3.js"><link rel="prefetch" href="/Note/assets/js/5.6cbca780.js"><link rel="prefetch" href="/Note/assets/js/6.92174d3c.js"><link rel="prefetch" href="/Note/assets/js/7.6a3045d5.js"><link rel="prefetch" href="/Note/assets/js/8.525bfe4b.js">
    <link rel="stylesheet" href="/Note/assets/css/0.styles.912d5f67.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Note/" class="home-link router-link-active"><!----> <span class="site-name">博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Note/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/G-Grant" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Note/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/G-Grant" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>《高性能JavaScript》读书笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Note/20171111.html#数据存储" class="sidebar-link">数据存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/20171111.html#作用域相关" class="sidebar-link">作用域相关</a></li></ul></li><li><a href="/Note/20171111.html#dom方面" class="sidebar-link">DOM方面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/20171111.html#dom-的访问和修改" class="sidebar-link">DOM 的访问和修改</a></li><li class="sidebar-sub-header"><a href="/Note/20171111.html#html-集合" class="sidebar-link">HTML 集合</a></li><li class="sidebar-sub-header"><a href="/Note/20171111.html#重绘与重排" class="sidebar-link">重绘与重排</a></li></ul></li><li><a href="/Note/20171111.html#算法和流程控制" class="sidebar-link">算法和流程控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/20171111.html#循环" class="sidebar-link">循环</a></li><li class="sidebar-sub-header"><a href="/Note/20171111.html#条件语句" class="sidebar-link">条件语句</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="《高性能javascript》读书笔记"><a href="#《高性能javascript》读书笔记" aria-hidden="true" class="header-anchor">#</a> 《高性能JavaScript》读书笔记</h1> <h2 id="数据存储"><a href="#数据存储" aria-hidden="true" class="header-anchor">#</a> 数据存储</h2> <blockquote><p>数组和对象成员的读取慢，字面量和局部变量读取快。</p></blockquote> <h3 id="作用域相关"><a href="#作用域相关" aria-hidden="true" class="header-anchor">#</a> 作用域相关</h3> <blockquote><p>每一个 JavaScript 函数都是 Function 对象的一个实例。 Function 对象同其他对象一样，拥有可以编程访问的属性和一系列不能通过代码访问，仅提供 JavaScript 引擎读取的内部属性。其中一个内部属性是 <code>[[Scope]]</code>。<code>[[Scope]]</code>属性包含了创建此函数的作用域对象的集合。</p></blockquote> <p>当 add 函数创建后，它的作用域链将插入一个对象变量，这个全局对象代表着所有在全局范围内定义的变量。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> sum <span class="token operator">=</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如图为它们之间的关系：</p> <p><img src="/Note/assets/img/scope1.fb0de43e.png" alt="img"></p> <p>函数 add 的作用域将会在执行时用到。假设执行如下代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>那么此时，作用域则为：</p> <p><img src="/Note/assets/img/scope2.532f671c.png" alt="img"></p> <p>在函数执行过程中，每遇到一个变量，都会经历一次查找，如果作用域链越深，那么查找越慢。所以，尽量使用局部变量。</p> <h2 id="dom方面"><a href="#dom方面" aria-hidden="true" class="header-anchor">#</a> DOM方面</h2> <blockquote><p>DOM 的慢是有原因的。浏览器通常会把 DOM 和 JavaScript 独立实现。比如 IE 中，JavaScript 的实现位于 jscript.dll 文件中； DOM 的实现则存在另一库中，名为 mshtml.dll（ 内部为 Trident ）。这个分离允许其他技术和语言，比如 VBScript ，能共享使用 DOM 以及 Trident 提供的渲染函数。正因为如此，两个相互独立的功能只能通过接口进行彼此连接，就会产生消耗。</p></blockquote> <h3 id="dom-的访问和修改"><a href="#dom-的访问和修改" aria-hidden="true" class="header-anchor">#</a> DOM 的访问和修改</h3> <ul><li>访问 DOM 的次数越多，代码运行速度越慢。通用的做法是：减少访问 DOM 的次数，把运算尽量留在 ECMAScript 这一端处理。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">// bad</span>

<span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        dcoument<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// good</span>

<span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        html <span class="token operator">+=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dcoument<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="html-集合"><a href="#html-集合" aria-hidden="true" class="header-anchor">#</a> HTML 集合</h3> <blockquote><p><code>document.getElementsByTagName()</code>、 <code>document.getElementsByClassName()</code>、 <code>document.getElementsByName()</code> 都返回一个类数组对象。这个对象一直与文档保持连接，每次你需要最新信息时，都会重复执行查询的过程，哪怕只是获取类数组对象的 length 。<strong>读取一个数组的 length 比读取集合要快</strong>。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">// 死循环</span>
<span class="token keyword">var</span> alldivs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> alldivs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>对于任何类型的 DOM 访问，需要多次访问同一个 DOM 属性或方法需要多次访问时，最好用一个局部变量缓存此成员。当遍历一个集合时，第一优化原则是把集合存储在局部变量中，并把 length 缓存在循环外部。</p></blockquote> <h3 id="重绘与重排"><a href="#重绘与重排" aria-hidden="true" class="header-anchor">#</a> 重绘与重排</h3> <blockquote><p>当 DOM 的变化影响了元素得几何属性（宽和高）--比如改变边框宽度或给段落增加文字，导致行数增加--浏览器需要重新计算元素得几何属性，同样其他元素的几何属性和位置也会受影响。浏览器会使渲染树中受到影响的部分失效，并重新构造渲染树。这个过程称之为<code>重排</code>。完成<code>重排</code>后，浏览器会重新绘制受到影响的部分到屏幕中，这个过程称之为<code>重绘</code>。</p></blockquote> <p>由于每次重排会产生计算消耗，大多数浏览器通过队列优化修改并批量执行来优化重排过程。然而，当使用<code>offsetTop</code>，<code>offsetLeft</code>，<code>offsetWidth</code>，<code>offsetHeight</code>，<code>scrollTop</code>，<code>scrollLeft</code>，<code>scrollWidth</code>，<code>scrollHeight</code>，<code>clientTop</code>，<code>clientLeft</code>，<code>clientWidth</code>，<code>clientHeight</code>，<code>getComputedStyle() (currentStyle in IE)</code> 会导致重新刷新队列。</p> <p>当需要对 DOM 元素进行一系列操作时，可以通过 1.使元素脱离文档流 2.对其应用多重改变 3.把元素带回文档中来减少重绘和重排次数。让元素脱离文档流的三种方法：</p> <ul><li>隐藏元素，修改，再显示</li> <li>使用文档片断，在当前 DOM 之外构建一个子树，再把它拷贝回文档</li> <li>把元素拷贝到一个脱离文档的节点，修改后再替换元素</li></ul> <h2 id="算法和流程控制"><a href="#算法和流程控制" aria-hidden="true" class="header-anchor">#</a> 算法和流程控制</h2> <h3 id="循环"><a href="#循环" aria-hidden="true" class="header-anchor">#</a> 循环</h3> <p>在要求运行速度时，基于函数的迭代比基于循环的要慢。例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 183.984ms</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.454ms</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="条件语句"><a href="#条件语句" aria-hidden="true" class="header-anchor">#</a> 条件语句</h3> <p><code>if-else</code> 尽可能把最大概率出现的情况放在前面。</p> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">8/10/2019, 7:38:12 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/Note/assets/js/app.d8addd1b.js" defer></script><script src="/Note/assets/js/2.ea6ca259.js" defer></script><script src="/Note/assets/js/9.00848bb5.js" defer></script><script src="/Note/assets/js/15.d0f1fe9f.js" defer></script>
  </body>
</html>
